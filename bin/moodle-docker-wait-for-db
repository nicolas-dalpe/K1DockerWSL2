#!/usr/bin/env bash
set -e

thisfile=$( readlink "${BASH_SOURCE[0]}" ) || thisfile="${BASH_SOURCE[0]}"
basedir="$( cd "$( dirname "$thisfile" )/../" && pwd -P )"

if [ -z "$MOODLE_DOCKER_DB" ];
then
    echo 'Error: $MOODLE_DOCKER_DB is not set'
    exit 1
fi
until $basedir/bin/moodle-docker-compose logs db | grep -q 'ready for connections';
    do
        echo 'Waiting for Mariadb to come up...'
        sleep 15
    done
